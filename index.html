<!DOCTYPE html>
<html ng-app="Play!">
<head>
    <meta charset="utf-8" />
    <title>Play! Compatibility</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        table, tr, td, th
        {
            border-collapse: collapse;
            border: 1px solid black;
            text-align: left;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.11/angular.min.js"></script>

    <script src="texts.js"></script>
    
</head>
<body id="page-top" ng-controller="angularController">
        <script>
                function get(name) {
                    if (name = (new RegExp('[?&]' + encodeURIComponent(name) + '=([^&]*)')).exec(location.search))
                        return decodeURIComponent(name[1]);
                }
        
                angular.module('Play!', []).controller("angularController", function($scope, $http, $filter) {
                    $scope.views = []
                    $scope.views.push([])
                    $scope.views.push([])
                    $scope.views.push([])
                    $scope.views.push([])
                    $scope.views.push([])
        
                    var lang = get('lang');
            if (lang == "en") {
                $scope.texts = texts[0]
                $scope.lang = "en"
           
            } else {
                var lang = window.navigator.language || window.navigator.userLanguage;
                if (lang.startsWith('en')) {
                    $scope.texts = texts[0]
                    $scope.lang = "en"
                }
            }
        
                
        
                    var pagination = true
                    var page = 1
                    while (pagination) {
                        if (page == 4) pagination = false
                        $http.get("https://api.github.com/repos/jpd002/play-compatibility/issues?state=open&page=" + page + "&per_page=100")
                            .success(function(data) {
        
                                var i = 0,
                                    j = 0
                                for (i = 0; i < data.length; i++) {
                                    data[i].status = 0
                                    data[i].color = "000000"
                                    for (j = 0; j < data[i].labels.length; j++) {
                                        if (data[i].labels[j].name == "state-nothing") { // Fatal label, breaking recursion
                                            data[i].color = data[i].labels[j].color
                                            data[i].status = 1
                                            break;
                                        } else if (data[i].labels[j].name == "state-playable") {
                                            data[i].color = data[i].labels[j].color
                                            data[i].status = 4
                                        } else if (data[i].labels[j].name =="state-loadable") {
                                            data[i].color = data[i].labels[j].color
                                            data[i].status = 2
                                        } else if (data[i].labels[j].name == "state-intro") {
                                            data[i].color = data[i].labels[j].color
                                            data[i].status = 3
                                        } else if (data[i].labels[j].name == "state-ingame") {
                                            data[i].color = data[i].labels[j].color
                                            data[i].status = 5
                                        }
                                    }
                                    if (data[i].status > 0) {
                                        $scope.views[data[i].status].push(data[i])
                                    }
                                    $scope.views[0].push(data[i])
                                    $scope.data = $scope.views[0];
                                    $scope.data = $filter('orderBy')($scope.data, 'title', false);
                                }
                            })
                            .error(function() {
                                pagination = false;
                            });
                        page++
                    }
        
                   
        
                  
        
                    // Angular filter
                    $scope.filterEntries = function(val) {
                        return function(entry) {
                            if (val == undefined) return true;
                            return (entry.title.toLowerCase().indexOf(val.toLowerCase() || '') !== -1);
                        }
                    }
                })
            </script>
    <div style="margin-left:25%; margin-right:25%">
        <table style="width:100%">
            <thead>
            <tr>
                <td>Game Name</td>
                <td>Status</td>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="entry in data | filter: filterEntries(field)">
                    <td align="left"><a href="{{entry.html_url}}"><small>{{entry.title}}</small></a></td>
                    <td bgcolor="{{entry.color}}"><font color="white"><small>{{texts[entry.status]}}</small></font></td>
            </tr>
            </tbody>
        </table>
    </div>
</body>
</html>